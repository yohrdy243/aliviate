"use client";
import { TClinicHistoryTable } from "@/models/TClinicHistory";
import { getClinicalHistories } from "@/services/ClinicHistoryService";
import { BsFillTrash3Fill } from "react-icons/bs";
import { Fragment, useEffect, useState } from "react";

const columns: { title: string; key: string; isDate?: boolean }[] = [
	{
		title: "Paciente",
		key: "nombreCompletoPaciente",
	},
	{
		title: "Atendido por",
		key: "nombreCompletoMedico",
	},
	{
		title: "ID Historia Clinica",
		key: "id",
	},
	{
		title: "Fecha",
		key: "fechaRegistro",
		isDate: true,
	},
];

export default function ClinicalHistoryTable({
	type = "all",
}: {
	type?: "all" | "delete";
}) {
	const [clinicalHistories, setClinicalHistories] = useState<
		TClinicHistoryTable[]
	>([]);

	useEffect(() => {
		getClinicalHistories().then((response) => {
			if (response !== false) {
				setClinicalHistories(response);
			}
		});
		// eslint-disable-next-line react-hooks/exhaustive-deps
	}, []);

	return (
		<table className="table-auto mt-4 w-full">
			<thead className="bg-[#BDD3FF] px-8">
				<tr>
					{columns.map(({ title }, index) => (
						<th
							className={`py-4 text-[18px] font-[700] text-left ${
								index === 0 && "pl-16"
							}`}
							key={`COLUMN_${title}_${index}`}
						>
							{title}
						</th>
					))}
					<th className="py-4 text-[18px] font-[700] text-left">Acciones</th>
				</tr>
			</thead>
			<tbody>
				{clinicalHistories.map((clinicHistory, rowIndex) => (
					<tr className="border-b" key={`CONSULTAS_${rowIndex}`}>
						{columns.map(({ key, isDate }, columnIndex) => {
							const value = clinicHistory[key as keyof typeof clinicHistory];
							return (
								<td
									className={`${
										columnIndex === 0 && "pl-16"
									} py-4 text-[13px] font-[400]`}
									key={`${clinicHistory["id"]}_${key}_${columnIndex}`}
								>
									{isDate
										? new Date(value as string).toLocaleDateString("es-PE", {
												day: "2-digit",
												month: "short",
												year: "numeric",
												hour: "2-digit",
												minute: "2-digit",
										  })
										: String(value)}
								</td>
							);
						})}

						<td className="flex py-4 ">
							{type === "all" ? (
								<Fragment>
									<svg
										width="30"
										height="30"
										viewBox="0 0 30 30"
										fill="none"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											d="M4.59375 18.25C3.65625 18.25 2.86458 17.9249 2.21875 17.2747C1.57292 16.6246 1.25 15.8351 1.25 14.9062C1.25 13.9774 1.57508 13.1879 2.22525 12.5378C2.87544 11.8876 3.66494 11.5625 4.59375 11.5625V7.71875C4.59375 7.21875 4.78125 6.78125 5.15625 6.40625C5.53125 6.03125 5.96875 5.84375 6.46875 5.84375H11.6562C11.6562 4.90625 11.9813 4.11458 12.6315 3.46875C13.2817 2.82292 14.0712 2.5 15 2.5C15.9288 2.5 16.7183 2.82508 17.3685 3.47525C18.0187 4.12544 18.3438 4.91494 18.3438 5.84375H23.5312C24.0312 5.84375 24.4688 6.03125 24.8438 6.40625C25.2188 6.78125 25.4062 7.21875 25.4062 7.71875V11.5625C26.3438 11.5625 27.1354 11.8876 27.7812 12.5378C28.4271 13.1879 28.75 13.9774 28.75 14.9062C28.75 15.8351 28.4249 16.6246 27.7747 17.2747C27.1246 17.9249 26.3351 18.25 25.4062 18.25V24.375C25.4062 24.875 25.2188 25.3125 24.8438 25.6875C24.4688 26.0625 24.0312 26.25 23.5312 26.25H6.46875C5.96875 26.25 5.53125 26.0625 5.15625 25.6875C4.78125 25.3125 4.59375 24.875 4.59375 24.375V18.25ZM10.7261 15.125C11.0754 15.125 11.3698 15.0028 11.6094 14.7583C11.849 14.5138 11.9688 14.2169 11.9688 13.8677C11.9688 13.5184 11.8465 13.224 11.602 12.9844C11.3575 12.7448 11.0607 12.625 10.7114 12.625C10.3621 12.625 10.0677 12.7472 9.82812 12.9917C9.58854 13.2362 9.46875 13.5331 9.46875 13.8823C9.46875 14.2316 9.59099 14.526 9.83547 14.7656C10.08 15.0052 10.3768 15.125 10.7261 15.125ZM19.2886 15.125C19.6379 15.125 19.9323 15.0028 20.1719 14.7583C20.4115 14.5138 20.5312 14.2169 20.5312 13.8677C20.5312 13.5184 20.409 13.224 20.1645 12.9844C19.92 12.7448 19.6232 12.625 19.2739 12.625C18.9246 12.625 18.6302 12.7472 18.3906 12.9917C18.151 13.2362 18.0312 13.5331 18.0312 13.8823C18.0312 14.2316 18.1535 14.526 18.398 14.7656C18.6425 15.0052 18.9393 15.125 19.2886 15.125ZM10.6875 21.0938H19.3125C19.5781 21.0938 19.8008 21.0034 19.9805 20.8227C20.1602 20.6419 20.25 20.4179 20.25 20.1508C20.25 19.8836 20.1602 19.6615 19.9805 19.4844C19.8008 19.3073 19.5781 19.2188 19.3125 19.2188H10.6875C10.4219 19.2188 10.1992 19.3091 10.0195 19.4898C9.83984 19.6706 9.75 19.8946 9.75 20.1617C9.75 20.4289 9.83984 20.651 10.0195 20.8281C10.1992 21.0052 10.4219 21.0938 10.6875 21.0938ZM6.46875 24.375H23.5312V7.71875H6.46875V24.375Z"
											fill="black"
										/>
									</svg>
									<svg
										width="30"
										height="30"
										viewBox="0 0 30 30"
										fill="none"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											d="M5.625 26.25C5.125 26.25 4.6875 26.0625 4.3125 25.6875C3.9375 25.3125 3.75 24.875 3.75 24.375V5.625C3.75 5.125 3.9375 4.6875 4.3125 4.3125C4.6875 3.9375 5.125 3.75 5.625 3.75H17C17.2656 3.75 17.4883 3.84036 17.668 4.02109C17.8477 4.20184 17.9375 4.4258 17.9375 4.69297C17.9375 4.96016 17.8477 5.18229 17.668 5.35938C17.4883 5.53646 17.2656 5.625 17 5.625H5.625V24.375H24.375V13C24.375 12.7344 24.4654 12.5117 24.6461 12.332C24.8268 12.1523 25.0508 12.0625 25.318 12.0625C25.5852 12.0625 25.8073 12.1523 25.9844 12.332C26.1615 12.5117 26.25 12.7344 26.25 13V24.375C26.25 24.875 26.0625 25.3125 25.6875 25.6875C25.3125 26.0625 24.875 26.25 24.375 26.25H5.625ZM10.9688 21.3438C10.7031 21.3438 10.4805 21.2534 10.3008 21.0727C10.1211 20.8919 10.0312 20.6679 10.0312 20.4008C10.0312 20.1336 10.1211 19.9115 10.3008 19.7344C10.4805 19.5573 10.7031 19.4688 10.9688 19.4688H19.0625C19.3281 19.4688 19.5508 19.5591 19.7305 19.7398C19.9102 19.9206 20 20.1446 20 20.4117C20 20.6789 19.9102 20.901 19.7305 21.0781C19.5508 21.2552 19.3281 21.3438 19.0625 21.3438H10.9688ZM10.9688 17.375C10.7031 17.375 10.4805 17.2846 10.3008 17.1039C10.1211 16.9232 10.0312 16.6992 10.0312 16.432C10.0312 16.1648 10.1211 15.9427 10.3008 15.7656C10.4805 15.5885 10.7031 15.5 10.9688 15.5H19.0625C19.3281 15.5 19.5508 15.5904 19.7305 15.7711C19.9102 15.9518 20 16.1758 20 16.443C20 16.7102 19.9102 16.9323 19.7305 17.1094C19.5508 17.2865 19.3281 17.375 19.0625 17.375H10.9688ZM10.9688 13.4062C10.7031 13.4062 10.4805 13.3159 10.3008 13.1352C10.1211 12.9544 10.0312 12.7304 10.0312 12.4633C10.0312 12.1961 10.1211 11.974 10.3008 11.7969C10.4805 11.6198 10.7031 11.5312 10.9688 11.5312H19.0625C19.3281 11.5312 19.5508 11.6216 19.7305 11.8023C19.9102 11.9831 20 12.2071 20 12.4742C20 12.7414 19.9102 12.9635 19.7305 13.1406C19.5508 13.3177 19.3281 13.4062 19.0625 13.4062H10.9688ZM22.557 11.125C22.2898 11.125 22.0677 11.0352 21.8906 10.8555C21.7135 10.6758 21.625 10.4531 21.625 10.1875V8.375H19.8125C19.5469 8.375 19.3242 8.28464 19.1445 8.10391C18.9648 7.92316 18.875 7.6992 18.875 7.43203C18.875 7.16484 18.9648 6.94271 19.1445 6.76562C19.3242 6.58854 19.5469 6.5 19.8125 6.5H21.625V4.6875C21.625 4.42188 21.7154 4.19922 21.8961 4.01953C22.0768 3.83984 22.3008 3.75 22.568 3.75C22.8352 3.75 23.0573 3.83984 23.2344 4.01953C23.4115 4.19922 23.5 4.42188 23.5 4.6875V6.5H25.3125C25.5781 6.5 25.8008 6.59036 25.9805 6.77109C26.1602 6.95184 26.25 7.1758 26.25 7.44297C26.25 7.71016 26.1602 7.93229 25.9805 8.10938C25.8008 8.28646 25.5781 8.375 25.3125 8.375H23.5V10.1875C23.5 10.4531 23.4096 10.6758 23.2289 10.8555C23.0482 11.0352 22.8242 11.125 22.557 11.125Z"
											fill="black"
										/>
									</svg>
									<svg
										width="30"
										height="30"
										viewBox="0 0 30 30"
										fill="none"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											d="M5.625 26.25C5.125 26.25 4.6875 26.0625 4.3125 25.6875C3.9375 25.3125 3.75 24.875 3.75 24.375V5.625C3.75 5.125 3.9375 4.6875 4.3125 4.3125C4.6875 3.9375 5.125 3.75 5.625 3.75H17C17.2656 3.75 17.4883 3.84036 17.668 4.02109C17.8477 4.20184 17.9375 4.4258 17.9375 4.69297C17.9375 4.96016 17.8477 5.18229 17.668 5.35938C17.4883 5.53646 17.2656 5.625 17 5.625H5.625V24.375H24.375V13C24.375 12.7344 24.4654 12.5117 24.6461 12.332C24.8268 12.1523 25.0508 12.0625 25.318 12.0625C25.5852 12.0625 25.8073 12.1523 25.9844 12.332C26.1615 12.5117 26.25 12.7344 26.25 13V24.375C26.25 24.875 26.0625 25.3125 25.6875 25.6875C25.3125 26.0625 24.875 26.25 24.375 26.25H5.625ZM10.9688 21.3438C10.7031 21.3438 10.4805 21.2534 10.3008 21.0727C10.1211 20.8919 10.0312 20.6679 10.0312 20.4008C10.0312 20.1336 10.1211 19.9115 10.3008 19.7344C10.4805 19.5573 10.7031 19.4688 10.9688 19.4688H19.0625C19.3281 19.4688 19.5508 19.5591 19.7305 19.7398C19.9102 19.9206 20 20.1446 20 20.4117C20 20.6789 19.9102 20.901 19.7305 21.0781C19.5508 21.2552 19.3281 21.3438 19.0625 21.3438H10.9688ZM10.9688 17.375C10.7031 17.375 10.4805 17.2846 10.3008 17.1039C10.1211 16.9232 10.0312 16.6992 10.0312 16.432C10.0312 16.1648 10.1211 15.9427 10.3008 15.7656C10.4805 15.5885 10.7031 15.5 10.9688 15.5H19.0625C19.3281 15.5 19.5508 15.5904 19.7305 15.7711C19.9102 15.9518 20 16.1758 20 16.443C20 16.7102 19.9102 16.9323 19.7305 17.1094C19.5508 17.2865 19.3281 17.375 19.0625 17.375H10.9688ZM10.9688 13.4062C10.7031 13.4062 10.4805 13.3159 10.3008 13.1352C10.1211 12.9544 10.0312 12.7304 10.0312 12.4633C10.0312 12.1961 10.1211 11.974 10.3008 11.7969C10.4805 11.6198 10.7031 11.5312 10.9688 11.5312H19.0625C19.3281 11.5312 19.5508 11.6216 19.7305 11.8023C19.9102 11.9831 20 12.2071 20 12.4742C20 12.7414 19.9102 12.9635 19.7305 13.1406C19.5508 13.3177 19.3281 13.4062 19.0625 13.4062H10.9688ZM22.557 11.125C22.2898 11.125 22.0677 11.0352 21.8906 10.8555C21.7135 10.6758 21.625 10.4531 21.625 10.1875V8.375H19.8125C19.5469 8.375 19.3242 8.28464 19.1445 8.10391C18.9648 7.92316 18.875 7.6992 18.875 7.43203C18.875 7.16484 18.9648 6.94271 19.1445 6.76562C19.3242 6.58854 19.5469 6.5 19.8125 6.5H21.625V4.6875C21.625 4.42188 21.7154 4.19922 21.8961 4.01953C22.0768 3.83984 22.3008 3.75 22.568 3.75C22.8352 3.75 23.0573 3.83984 23.2344 4.01953C23.4115 4.19922 23.5 4.42188 23.5 4.6875V6.5H25.3125C25.5781 6.5 25.8008 6.59036 25.9805 6.77109C26.1602 6.95184 26.25 7.1758 26.25 7.44297C26.25 7.71016 26.1602 7.93229 25.9805 8.10938C25.8008 8.28646 25.5781 8.375 25.3125 8.375H23.5V10.1875C23.5 10.4531 23.4096 10.6758 23.2289 10.8555C23.0482 11.0352 22.8242 11.125 22.557 11.125Z"
											fill="black"
										/>
									</svg>
								</Fragment>
							) : (
								type === "delete" && <BsFillTrash3Fill />
							)}
						</td>
					</tr>
				))}
			</tbody>
		</table>
	);
}
